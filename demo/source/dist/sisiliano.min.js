var htmlTempl=htmlTempl||{};htmlTempl.templates={"src/controllers/knob/knob.html":'<div tabindex="0"\r\n     class="sisiliano"\r\n     role="slider"\r\n     aria-label="{{title}}"\r\n     aria-describedby="{{description}}"\r\n     aria-valuenow=""\r\n     aria-valuemax="{{max}}"\r\n     aria-valuemin="{{min}}">\r\n    <svg\r\n            xmlns:osb="http://www.openswatchbook.org/uri/2009/osb"\r\n            xmlns:dc="http://purl.org/dc/elements/1.1/"\r\n            xmlns:cc="http://creativecommons.org/ns#"\r\n            xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"\r\n            xmlns:svg="http://www.w3.org/2000/svg"\r\n            xmlns="http://www.w3.org/2000/svg"\r\n            xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"\r\n            viewBox="0 0 300 300"\r\n            width="100%"\r\n            height="100%"\r\n            class="sisiliano-knob">\r\n        <defs\r\n                id="defs4">\r\n            <filter\r\n                    style="color-interpolation-filters:sRGB;"\r\n                    id="filter6244">\r\n                <feFlood\r\n                        flood-opacity="0.4"\r\n                        flood-color="black"\r\n                        result="flood"\r\n                        id="feFlood6246" />\r\n                <feComposite\r\n                        in="flood"\r\n                        in2="SourceGraphic"\r\n                        operator="in"\r\n                        result="composite1"\r\n                        id="feComposite6248" />\r\n                <feGaussianBlur\r\n                        in="composite1"\r\n                        stdDeviation="3"\r\n                        result="blur"\r\n                        id="feGaussianBlur6250" />\r\n                <feOffset\r\n                        dx="-1"\r\n                        dy="1"\r\n                        result="offset"\r\n                        id="feOffset6252" />\r\n                <feComposite\r\n                        in="SourceGraphic"\r\n                        in2="offset"\r\n                        operator="over"\r\n                        result="composite2"\r\n                        id="feComposite6254" />\r\n            </filter>\r\n            <filter\r\n                    style="color-interpolation-filters:sRGB;"\r\n                    id="filter6245">\r\n                <feFlood\r\n                        flood-opacity="0.5"\r\n                        flood-color="black"\r\n                        result="flood"\r\n                        id="feFlood6246" />\r\n                <feComposite\r\n                        in="flood"\r\n                        in2="SourceGraphic"\r\n                        operator="in"\r\n                        result="composite1"\r\n                        id="feComposite6248" />\r\n                <feGaussianBlur\r\n                        in="composite1"\r\n                        stdDeviation="3.5"\r\n                        result="blur"\r\n                        id="feGaussianBlur6250" />\r\n                <feOffset\r\n                        dx="2"\r\n                        dy="-2"\r\n                        result="offset"\r\n                        id="feOffset6252" />\r\n                <feComposite\r\n                        in="SourceGraphic"\r\n                        in2="offset"\r\n                        operator="over"\r\n                        result="composite2"\r\n                        id="feComposite6254" />\r\n            </filter>\r\n        </defs>\r\n\r\n        <style>\r\n            .sisiliano-knob-circle {\r\n                filter: url("#filter6244");\r\n            }\r\n            .sisiliano-border, .sisiliano:focus .sisiliano-knob-circle {\r\n                filter: url("#filter6245");\r\n            }\r\n        </style>\r\n\r\n        <g style="display:inline">\r\n            <circle\r\n                    class="sisiliano-border"\r\n                    r="147" cx="150"\r\n                    cy="150">\r\n            </circle>\r\n            <circle\r\n                    class="sisiliano-knob-circle sisiliano-knob-background-circle"\r\n                    id="circle5634"\r\n                    r="130"\r\n                    cx="150"\r\n                    cy="150"/>\r\n            <text xmlns="http://www.w3.org/2000/svg" x="40" y="170"\r\n                  class="unselectable sisiliano-knob-value-text">\r\n                100\r\n            </text>\r\n            <circle\r\n                    class="sisiliano-knob-circle sisiliano-knob-value-circle"\r\n                    fill="transparent"\r\n                    id="circle5636"\r\n                    r="130"\r\n                    cx="150"\r\n                    cy="150"\r\n                    transform="rotate(90, 150, 150)"\r\n                    stroke-width="20"/>\r\n        </g>\r\n    </svg>\r\n</div>',"src/controllers/piano/piano.html":'<div tabindex="0" class="sisiliano" aria-label="{{title}} ,{{description}}" id="{{id}}">\r\n    <svg\r\n            xmlns:osb="http://www.openswatchbook.org/uri/2009/osb"\r\n            xmlns:dc="http://purl.org/dc/elements/1.1/"\r\n            xmlns:cc="http://creativecommons.org/ns#"\r\n            xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"\r\n            xmlns:svg="http://www.w3.org/2000/svg"\r\n            xmlns="http://www.w3.org/2000/svg"\r\n            xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"\r\n            class="sisiliano-piano"\r\n            width="100%"\r\n            height="100%"\r\n            viewBox="0 0 {{viewBox.width}} {{viewBox.height}}">\r\n        <defs\r\n                id="defs4">\r\n            <filter\r\n                    style="color-interpolation-filters:sRGB;"\r\n                    id="filter6244">\r\n                <feFlood\r\n                        flood-opacity="0.5"\r\n                        flood-color="black"\r\n                        result="flood"\r\n                        id="feFlood6246"/>\r\n                <feComposite\r\n                        in="flood"\r\n                        in2="SourceGraphic"\r\n                        operator="in"\r\n                        result="composite1"\r\n                        id="feComposite6248"/>\r\n                <feGaussianBlur\r\n                        in="composite1"\r\n                        stdDeviation="3"\r\n                        result="blur"\r\n                        id="feGaussianBlur6250"/>\r\n                <feOffset\r\n                        dx="0"\r\n                        dy="1"\r\n                        result="offset"\r\n                        id="feOffset6252"/>\r\n                <feComposite\r\n                        in="SourceGraphic"\r\n                        in2="offset"\r\n                        operator="over"\r\n                        result="composite2"\r\n                        id="feComposite6254"/>\r\n            </filter>\r\n            <filter\r\n                    style="color-interpolation-filters:sRGB;"\r\n                    id="filter6245">\r\n                <feFlood\r\n                        flood-opacity="0.5"\r\n                        flood-color="black"\r\n                        result="flood"\r\n                        id="feFlood6246"/>\r\n                <feComposite\r\n                        in="flood"\r\n                        in2="SourceGraphic"\r\n                        operator="in"\r\n                        result="composite1"\r\n                        id="feComposite6248"/>\r\n                <feGaussianBlur\r\n                        in="composite1"\r\n                        stdDeviation="8"\r\n                        result="blur"\r\n                        id="feGaussianBlur6250"/>\r\n                <feOffset\r\n                        dx="-3"\r\n                        dy="3.5"\r\n                        result="offset"\r\n                        id="feOffset6252"/>\r\n                <feComposite\r\n                        in="SourceGraphic"\r\n                        in2="offset"\r\n                        operator="over"\r\n                        result="composite2"\r\n                        id="feComposite6254"/>\r\n            </filter>\r\n            <filter\r\n                    style="color-interpolation-filters:sRGB;"\r\n                    id="filter6245">\r\n                <feFlood\r\n                        flood-opacity="0.5"\r\n                        flood-color="black"\r\n                        result="flood"\r\n                        id="feFlood6246"/>\r\n                <feComposite\r\n                        in="flood"\r\n                        in2="SourceGraphic"\r\n                        operator="in"\r\n                        result="composite1"\r\n                        id="feComposite6248"/>\r\n                <feGaussianBlur\r\n                        in="composite1"\r\n                        stdDeviation="3.5"\r\n                        result="blur"\r\n                        id="feGaussianBlur6250"/>\r\n                <feOffset\r\n                        dx="2"\r\n                        dy="-2"\r\n                        result="offset"\r\n                        id="feOffset6252"/>\r\n                <feComposite\r\n                        in="SourceGraphic"\r\n                        in2="offset"\r\n                        operator="over"\r\n                        result="composite2"\r\n                        id="feComposite6254"/>\r\n            </filter>\r\n        </defs>\r\n\r\n        <style>\r\n            /* These styles have been added seperately as a fix for firefox and IE */\r\n            #{{id}}.sisiliano .sisiliano-piano .sisiliano-piano-white-key {\r\n                filter: url(\'#filter6244\');\r\n            }\r\n\r\n            #{{id}}.sisiliano .sisiliano-piano .sisiliano-piano-black-key {\r\n                filter: url(\'#filter6244\');\r\n            }\r\n\r\n            #{{id}}.sisiliano-border {\r\n                filter: url("#filter6245");\r\n            }\r\n\r\n            #{{id}}.sisiliano .sisiliano-piano .sisiliano-piano-key-pressed,\r\n            #{{id}}.sisiliano .sisiliano-piano .sisiliano-piano-white-key:hover,\r\n            #{{id}}.sisiliano .sisiliano-piano .sisiliano-piano-black-key:hover,\r\n            #{{id}}.sisiliano .sisiliano-piano .sisiliano-piano-key-inactive:hover {\r\n                fill: {{color}};\r\n                stroke: {{color}};\r\n            }\r\n        </style>\r\n        <g style="display:inline">\r\n            <text\r\n                    x="{{keyBoard.border.x}}"\r\n                    y="{{keyBoard.border.y}}"\r\n                    aria-live="assertive"\r\n                    class="sisiliano-piano-active-area-status">\r\n                Piano is active from G to C\r\n            </text>\r\n            <rect\r\n                    class="sisiliano-border"\r\n                    height="{{keyBoard.border.height}}"\r\n                    width="{{keyBoard.border.width}}"\r\n                    x="{{keyBoard.border.x}}"\r\n                    y="{{keyBoard.border.y}}"/>\r\n            {{#each keyBoard.whiteKeys}}\r\n            <rect\r\n                    index="{{index}}"\r\n                    class="sisiliano-piano-key sisiliano-piano-white-key"\r\n                    height="{{height}}"\r\n                    width="{{width}}"\r\n                    x="{{x}}"\r\n                    y="{{y}}"/>\r\n            {{/each}}\r\n            {{#each keyBoard.blackKeys}}\r\n            <rect\r\n                    index="{{index}}"\r\n                    class="sisiliano-piano-key sisiliano-piano-black-key"\r\n                    height="{{height}}"\r\n                    width="{{width}}"\r\n                    x="{{x}}"\r\n                    y="{{y}}"/>\r\n            {{/each}}\r\n        </g>\r\n\r\n        <!--<g style="display:inline">\r\n          <rect\r\n            class="sisiliano-piano-key sisiliano-piano-disabledArea"\r\n            height="{{disabledArea.left.height}}"\r\n            width="{{disabledArea.left.width}}"\r\n            x="{{disabledArea.left.x}}"\r\n            y="{{disabledArea.left.y}}" />\r\n          <rect\r\n            class="sisiliano-piano-key sisiliano-piano-disabledArea"\r\n            height="{{disabledArea.right.height}}"\r\n            width="{{disabledArea.right.width}}"\r\n            x="{{disabledArea.right.x}}"\r\n            y="{{disabledArea.right.y}}" />\r\n        </g>-->\r\n    </svg>\r\n</div>\r\n'},function(a){"use strict";a.registerNamespace("sisiliano"),sisiliano.templates=htmlTempl.templates,a.registerNamespace("sisiliano.util"),sisiliano.util.templateCache={},sisiliano.util.getTemplate=function(a,b){var c=sisiliano.util.templateCache[b];if(c)a(c);else{var d=htmlTempl.templates[b];c=Handlebars.compile(d),sisiliano.util.templateCache[b]=c,a(c)}},sisiliano.util.addClass=function(a,b){sisiliano.util.removeClass(a,b);var c=$(a).attr("class"),d=c+" "+b;$(a).attr("class",d)},sisiliano.util.removeClass=function(a,b){var c=$(a).attr("class"),d=c.replace(new RegExp(" "+b,"g"),"").replace(new RegExp(b,"g"),"");$(a).attr("class",d)},sisiliano.util.getAngle=function(a,b){var c=Math.atan(Math.abs((b.x-a.x)/(b.y-a.y)))/(2*Math.PI);return a.x>b.x?a.y>b.y&&(c=.5-c):(a.y<b.y&&(c=.5-c),c+=.5),c},sisiliano.util.isInsideTheCircle=function(a,b,c){var d=Math.sqrt(Math.pow(c.x-a.x,2)+Math.pow(c.y-a.y,2));return b>=d}}(fluid),function(a){"use strict";a.defaults("sisiliano.knob",{gradeNames:["fluid.viewComponent"],model:{min:0,max:100,color:"#009688",value:null,tickValue:1,status:{isActive:!1},formatValue:function(a){return Math.round(100*a)/100},title:"Knob Controoler",description:"Use up and down keys to increase and decrease the value. If you are using the mouse, Drag around the center to adjust the value"},selectors:{controller:".sisiliano",svg:"svg",valueLabel:".sisiliano-knob-value-text",valueCircle:".sisiliano-knob-value-circle",knobBackgroundCircle:".sisiliano-knob-background-circle",borderCircle:"sisiliano-knob-circle sisiliano-knob-border-circle",circles:".sisiliano-knob-circle"},events:{onChange:null},listeners:{onCreate:{func:"sisiliano.knob.onCreate",args:["{that}"]}},modelListeners:{value:{func:"sisiliano.knob.onValueChange",args:["{that}","{that}.model.value"]},formatValue:{func:"sisiliano.knob.onValueChange",args:["{that}","{that}.model.value"]},color:{func:"sisiliano.knob.onColorChange",args:["{that}","{that}.model.color"]},"status.isActive":{func:"sisiliano.knob.onStatusChange",args:["{that}","{that}.model.status.isActive"]},min:{func:"sisiliano.knob.onMinValueChange",args:["{that}","{that}.model.min"]},max:{func:"sisiliano.knob.onMaxValueChange",args:["{that}","{that}.model.max"]}}}),sisiliano.knob.onMinValueChange=function(a,b){a.locate("controller").attr("aria-valuemin",b),sisiliano.knob.onValueChange(a,a.model.value)},sisiliano.knob.onMaxValueChange=function(a,b){a.locate("controller").attr("aria-valuemax",b),sisiliano.knob.onValueChange(a,a.model.value)},sisiliano.knob.onStatusChange=function(a,b){var c="sisiliano-knob"+(b?" sisiliano-active":"");d3.select(a.container.get(0)).select(".sisiliano-knob").attr("class",c)},sisiliano.knob.onValueChange=function(a,b){"number"!=typeof b&&sisiliano.knob.updateTheValueInUI(a,a.model.min),b<a.model.min?(b=a.model.min,a.applier.change("value",b)):b>a.model.max?(b=a.model.max,a.applier.change("value",b)):sisiliano.knob.updateTheValueInUI(a,b)},sisiliano.knob.updateTheValueInUI=function(a,b){var c=b;a.model.formatValue&&"function"==typeof a.model.formatValue&&(c=a.model.formatValue(b)),a.locate("controller").attr("aria-valuenow",c),a.locate("valueLabel").text(c);var d=sisiliano.knob.getSize(a),e=sisiliano.knob.getObviousValue(a,b),f=a.model.circumference/d*(d-e)+"px";a.locate("valueCircle").attr("stroke-dashoffset",f)},sisiliano.knob.onColorChange=function(a,b){a.locate("valueCircle").css("stroke",b),a.locate("knobBackgroundCircle").css("stroke",b),a.locate("valueCircle").css("fill",b),a.locate("knobBackgroundCircle").css("fill",b),a.locate("valueLabel").css("fill",b)},sisiliano.knob.init=function(a){var b=parseInt(a.locate("knobBackgroundCircle").attr("r"),"");a.applier.change("radius",b),a.applier.change("circumference",2*a.model.radius*Math.PI),a.locate("circles").attr("stroke-dasharray",a.model.circumference+"px")},sisiliano.knob.onCreate=function(a){sisiliano.knob.validateInputs(a),sisiliano.util.getTemplate(function(b){var c=b(a.model);a.container.html(c),sisiliano.knob.init(a),sisiliano.knob.onColorChange(a,a.model.color),sisiliano.knob.onValueChange(a,a.model.value),sisiliano.knob.addListeners(a)},"src/controllers/knob/knob.html")},sisiliano.knob.validateInputs=function(a){if(a.model.min>=a.model.max)throw new Error("Min should be less than max")},sisiliano.knob.addListeners=function(a){var b=function(){var b=d3.mouse(a.container.find("svg").eq(0).get(0)),c={x:150,y:150},d={x:b[0],y:b[1]};a.model.status.isActive&&(sisiliano.knob.setValueByAngle(a,c,d),d3.event.preventDefault())},c=function(){var b=sisiliano.knob.getValue(a);38===d3.event.keyCode?(a.applier.change("value",b+a.model.tickValue),d3.event.preventDefault()):40===d3.event.keyCode&&(a.applier.change("value",b-a.model.tickValue),d3.event.preventDefault())};document.addEventListener("mousemove",function(b){var c=a.locate("svg");if(c&&c.length>0){var d=c.position(),e={x:d.left+c.width()/2,y:d.top+c.height()/2},f={x:b.pageX,y:b.pageY};if(a.model.status.isActive)return sisiliano.knob.setValueByAngle(a,e,f),!1}}),document.addEventListener("mouseup",sisiliano.knob.setKnobActiveStatus.bind(this,a,!1)),d3.select(a.container.get(0)).on("keydown",c).on("mousedown",sisiliano.knob.setKnobActiveStatus.bind(this,a,!0)).on("touchstart",sisiliano.knob.setKnobActiveStatus.bind(this,a,!0)).on("touchmove",b).on("mousemove",b).on("mouseup",sisiliano.knob.setKnobActiveStatus.bind(this,a,!1)).on("touchend",sisiliano.knob.setKnobActiveStatus.bind(this,a,!1))},sisiliano.knob.setKnobActiveStatus=function(a,b){a.applier.change("status.isActive",b)},sisiliano.knob.setValueByAngle=function(a,b,c){var d=sisiliano.util.getAngle(b,c)*sisiliano.knob.getSize(a);a.model.value!==d&&a.applier.change("value",d+a.model.min)},sisiliano.knob.getSize=function(a){return Math.abs(a.model.max-a.model.min)},sisiliano.knob.getValue=function(a){return"number"==typeof a.model.value?a.model.value:a.model.min},sisiliano.knob.getObviousValue=function(a,b){return b-a.model.min}}(fluid),function(a){"use strict";a.defaults("sisiliano.piano",{gradeNames:["fluid.viewComponent"],model:{title:"Piano Controller",description:"The keys are accessible by mouse and the keyboad as well. Only the active area of the piano is accessible by the keyboard. If you want to move the active area, use left and right keys.",color:"#4CAF50",keyBoard:{keys:[],length:36,start:0,whiteKey:{width:40,height:150},blackKey:{width:27,height:100},padding:{top:20,bottom:20,left:20,right:20},border:{x:0,y:0,width:600,height:170},borderPadding:{top:10,bottom:10,left:10,right:10}},viewBox:{width:600,height:170},activeArea:{start:0,end:10}},events:{onChange:null,onKeyPress:null,onKeyRelease:null},selectors:{root:".sisiliano",keyBoard:".sisiliano-piano-key-board",whiteKeys:".sisiliano-piano-white-key",blackKeys:".sisiliano-piano-black-key",keys:".sisiliano-piano-key",activeAreaStatus:".sisiliano-piano-active-area-status"},listeners:{onCreate:{func:"sisiliano.piano.onCreate",args:["{that}","{that}.dom.keyBoard"]}},modelListeners:{viewBox:{func:"sisiliano.piano.onChange",args:["{that}","{change}"]},"activeArea.end":{func:"sisiliano.piano.onChangeActiveArea",args:["{that}","{that}.model.keyBoard.keys","{that}.model.activeArea"]},"keyBoard.keys":{func:"sisiliano.piano.onKeysChange",args:["{that}","{that}.model.keyBoard.keys"]}}}),sisiliano.piano.onChange=function(){},sisiliano.piano.onChangeActiveArea=function(a,b,c){var d=[81,65,87,83,69,68,82,70,84,71,89,72,85,74,73,75,79,76,80,186,219,222,221],e=sisiliano.piano.getWhiteKeys(b);if(e.length>0){var f=e[c.start],g=e[Math.min(c.end,a.model.keyBoard.length-1)],h=f.index,i=g.index,j="The piano is active from "+sisiliano.piano.getMusicNote(f)+" to "+sisiliano.piano.getMusicNote(g);if(a.locate("activeAreaStatus").text(j),h>0){var k=b[h-1];"BLACK"===k.color&&h--}if(i<b.length-1){var l=b[i+1];"BLACK"===l.color&&i++}for(var m=0,n=0;n<b.length;n++){var o=b[n];o.isActive=n>=h&&i>=n,o.isActive&&0===m&&"WHITE"===o.color&&m++,m>1&&"WHITE"===o.color&&"WHITE"===b[n-1].color&&m++,o.isActive?(o.keyCode=d[m],m++):o.keyCode=null}}sisiliano.piano.onKeysChange(a,b),sisiliano.piano.clearPressedNodes(a)},sisiliano.piano.onKeysChange=function(a,b){d3.select(a.container.get(0)).selectAll(".sisiliano-piano-key").each(function(){var c=sisiliano.piano.getElementKey(d3.select(this),b);sisiliano.piano.updateKey(a,c,d3.select(this))})},sisiliano.piano.getElementKey=function(a,b){return b[a.attr("index")]},sisiliano.piano.onCreate=function(a){sisiliano.piano.generateKeyboard(a),sisiliano.piano.refresh(a),sisiliano.piano.appendListeners(a)},sisiliano.piano.refresh=function(a){sisiliano.util.getTemplate(function(b){a.model.id="fluid-sisiliano-id-"+a.id,a.model.keyBoard.whiteKeys=sisiliano.piano.getWhiteKeys(a.model.keyBoard.keys),a.model.keyBoard.blackKeys=sisiliano.piano.getBlackKeys(a.model.keyBoard.keys);var c=b(a.model);a.container.html(c),sisiliano.piano.onChangeActiveArea(a,a.model.keyBoard.keys,a.model.activeArea)},"src/controllers/piano/piano.html")},sisiliano.piano.moveTabBy=function(a,b){if(b){var c={start:a.model.activeArea.start+b,end:a.model.activeArea.end+b},d=sisiliano.piano.getWhiteKeys(a.model.keyBoard.keys),e=c.start>=0&&c.start<d.length&&c.end>=0&&c.end<d.length&&c.start<c.end;e&&a.applier.change("activeArea",c)}},sisiliano.piano.clearPressedNodes=function(a){for(var b=0;b<a.model.keyBoard.keys.length;b++){var c=a.model.keyBoard.keys[b];c.isPressed=!1,sisiliano.piano.updateKey(a,c),sisiliano.piano.releaseKey(a,c)}},sisiliano.piano.appendListeners=function(a){var b=!1;d3.select(document).on("mouseup",function(){b=!1});var c=function(){b=!0;var c=d3.select(this).attr("index"),d=a.model.keyBoard.keys[c];b&&!d.isPressed&&(d.isPressed=!0,sisiliano.piano.updateKey(a,d),sisiliano.piano.playKey(a,d))},d=function(){var c=d3.select(this).attr("index"),d=a.model.keyBoard.keys[c];b&&!d.isPressed&&(d.isPressed=!0,sisiliano.piano.updateKey(a,d),sisiliano.piano.playKey(a,d)),d3.event.preventDefault()},e=function(){b=!1;var c=d3.select(this).attr("index"),d=a.model.keyBoard.keys[c];d.isPressed=!1,sisiliano.piano.updateKey(a,d),sisiliano.piano.releaseKey(a,d)},f=function(){var b=d3.select(this).attr("index"),c=a.model.keyBoard.keys[b];c.isPressed=!1,sisiliano.piano.updateKey(a,c),sisiliano.piano.releaseKey(a,c),d3.event.preventDefault()};d3.select(a.container.get(0)).selectAll(".sisiliano-piano-key").on("mousedown",c).on("touchstart",c).on("mouseover",d).on("touchmove",d).on("mouseup",e).on("touchend",e).on("touchcancel",f).on("mouseleave",f),d3.select(a.container.get(0)).on("keydown",function(){var b=d3.event.keyCode,c=sisiliano.piano.getKeyByComputerKeyCode(b,a.model.keyBoard.keys);switch(c&&!c.isPressed&&(c.isPressed=!0,sisiliano.piano.updateKey(a,c),sisiliano.piano.playKey(a,c)),b){case 37:sisiliano.piano.moveTabBy(a,-1),d3.event.preventDefault();break;case 39:sisiliano.piano.moveTabBy(a,1),d3.event.preventDefault()}}),d3.select(a.container.get(0)).on("keyup",function(){var b=d3.event.keyCode,c=sisiliano.piano.getKeyByComputerKeyCode(b,a.model.keyBoard.keys);c&&(c.isPressed=!1,sisiliano.piano.updateKey(a,c),sisiliano.piano.releaseKey(a,c),d3.event.preventDefault())})},sisiliano.piano.playKey=function(a,b){a.events.onKeyPress.fire(b.index,sisiliano.piano.getFreequency(b.octave,b.octaveIndex))},sisiliano.piano.releaseKey=function(a,b){a.events.onKeyRelease.fire(b.index)},sisiliano.piano.updateKey=function(a,b,c){c||(c=a.container.find(".sisiliano-piano-key[index='"+b.index+"']"));var d=b.className;d+=b.isActive?" sisiliano-piano-key-active":" sisiliano-piano-key-inactive",d+=b.isPressed?" sisiliano-piano-key-pressed":"",c.attr("class",d)},sisiliano.piano.getKeyByComputerKeyCode=function(a,b){var c=b.filter(function(b){return b.keyCode===a});return 0===c.length?null:c[0]},sisiliano.piano.getKeysByColor=function(a,b){return a.filter(function(a){return a.color===b})},sisiliano.piano.getFreequency=function(a,b){var c=[261.626,277.183,293.665,311.127,329.628,349.228,369.994,391.995,415.305,440,466.164,493.883];return Math.pow(2,a)*c[b]},sisiliano.piano.OCTAVE={0:{color:"WHITE",note:"c"},1:{color:"BLACK",note:"c#"},2:{color:"WHITE",note:"d"},3:{color:"BLACK",note:"d#"},4:{color:"WHITE",note:"e"},5:{color:"WHITE",note:"f"},6:{color:"BLACK",note:"f#"},7:{color:"WHITE",note:"g"},8:{color:"BLACK",note:"g#"},9:{color:"WHITE",note:"a"},10:{color:"BLACK",note:"a#"},11:{color:"WHITE",note:"b"}},sisiliano.piano.getPianoKey=function(a){return sisiliano.piano.OCTAVE[a.octaveIndex]},sisiliano.piano.getMusicNote=function(a){var b=sisiliano.piano.getPianoKey(a);return b.note+" in octave "+(a.octave+1)},sisiliano.piano.getWhiteKeys=function(a){return sisiliano.piano.getKeysByColor(a,"WHITE")},sisiliano.piano.getBlackKeys=function(a){return sisiliano.piano.getKeysByColor(a,"BLACK")},sisiliano.piano.generateKeyboard=function(a){a.model.keyBoard.blackKey.width=(a.model.keyBoard.whiteKey.width-1)/3*2+1,a.model.keyBoard.blackKey.height=a.model.keyBoard.whiteKey.height/3*2,a.model.keyBoard.keys=[];for(var b={whiteKeys:0,blackKeys:0},c=0,d=a.model.keyBoard.start;d<a.model.keyBoard.length+a.model.keyBoard.start;d++,c++){var e,f=d%12;"WHITE"===sisiliano.piano.OCTAVE[f].color?(e={color:"WHITE",x:a.model.keyBoard.padding.left+b.whiteKeys*a.model.keyBoard.whiteKey.width,y:a.model.keyBoard.padding.top,width:a.model.keyBoard.whiteKey.width-1,height:a.model.keyBoard.whiteKey.height,index:c,octave:Math.floor(d/12),octaveIndex:f,className:"sisiliano-piano-key sisiliano-piano-white-key"},b.whiteKeys++):"BLACK"===sisiliano.piano.OCTAVE[f].color&&(e={color:"BLACK",x:a.model.keyBoard.padding.left+(b.whiteKeys-1)*a.model.keyBoard.whiteKey.width+a.model.keyBoard.whiteKey.width/3*2,y:a.model.keyBoard.padding.top,width:a.model.keyBoard.blackKey.width,height:a.model.keyBoard.blackKey.height,index:c,octave:Math.floor(d/12),octaveIndex:f,className:"sisiliano-piano-key sisiliano-piano-black-key"},b.blackKeys++),a.model.keyBoard.keys.push(e)}a.model.viewBox.width=b.whiteKeys*a.model.keyBoard.whiteKey.width+a.model.keyBoard.padding.left+a.model.keyBoard.padding.right,a.model.viewBox.height=a.model.keyBoard.whiteKey.height+a.model.keyBoard.padding.top+a.model.keyBoard.padding.bottom,a.model.keyBoard.border.width=b.whiteKeys*a.model.keyBoard.whiteKey.width+a.model.keyBoard.borderPadding.left+a.model.keyBoard.borderPadding.right,a.model.keyBoard.border.height=a.model.keyBoard.whiteKey.height+a.model.keyBoard.borderPadding.top+a.model.keyBoard.borderPadding.bottom,a.model.keyBoard.border.x=a.model.keyBoard.keys[0].x-a.model.keyBoard.borderPadding.left,a.model.keyBoard.border.y=a.model.keyBoard.keys[0].y-a.model.keyBoard.borderPadding.top,a.applier.change("",a.model)}}(fluid);